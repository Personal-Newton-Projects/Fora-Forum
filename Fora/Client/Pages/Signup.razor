@page "/signup"

@inject IUserManager UserManager
@inject ILoginManager LoginManager
@inject IInterestManager InterestManager
@inject IJSRuntime JSRuntime

<EditForm Model="Login" OnSubmit="HandleSubmit"> 
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    <InputText @bind-Value="Login.Username" Placeholder="Username"></InputText>
    <InputText @bind-Value="Login.Password" Placeholder="Password"></InputText>
    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>
@code {
    [Parameter]
    public LoginModel Login { get; set; } = new();

    public async Task HandleSubmit()
    {
        Console.WriteLine("Submitted");
        //Calls method to

        var User = await UserManager.Create(
            await InitializeUserFromLogin(Login),
            Login
        );

        Console.WriteLine("Created!");
        await JSRuntime.InvokeAsync<UserModel>("console.log", Login);
        //await LoginManager.LogInWithUser(Login);
    }

    async Task<UserModel> InitializeUserFromLogin(LoginModel login)
    {
        return new UserModel()
            {
                Id = 1,
                Username = login.Username,
                Interests = new List<InterestModel>(),
                UserInterests = new List<UserInterestModel>(),
                Messages = new List<MessageModel>(),
                Threads = new List<ThreadModel>(),
                Deleted = false,
                Banned = false,
            };
        // await UserManager.GetUserCount() +

    }
}
